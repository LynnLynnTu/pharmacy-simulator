<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ–°è—¥å»ºæª”æ¨¡æ“¬ç³»çµ±ï¼ˆå–®æª”ç‰ˆï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body { 
        min-height: 100vh; 
        font-family: 'Noto Sans TC', sans-serif; /* æ‡‰ç”¨æ–°å­—é«” */
    }
    #fallback { display:none; padding:16px; color:#334155; }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
    
    /* å°ˆæ¥­è¡¨æ ¼æ¨™é ­æ¨£å¼ */
    .order-table th {
        background-color: #059669; /* emerald-600 */
        color: white; 
        font-weight: 500;
    }
    /* å¼·åŒ–è¼¸å…¥æ¡†çš„ç„¦é»æ•ˆæœ */
    .focus-style:focus {
        border-color: #059669; /* emerald-600 */
        box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.2); /* æŸ”å’Œçš„ç’°å½¢é™°å½± */
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="root"></div>
  <div id="fallback">
    <h2 class="text-lg font-bold mb-2">é é¢æ²’æœ‰é¡¯ç¤ºï¼Ÿ</h2>
    <ol class="list-decimal pl-6 space-y-1">
      <li>è«‹ç¢ºèªç¶²è·¯æš¢é€šï¼ˆæœ¬é éœ€è¼‰å…¥å¤–éƒ¨ç¨‹å¼åº«ï¼‰ã€‚</li>
      <li>è‹¥ä»ç©ºç™½ï¼Œè«‹æŒ‰ <span class="mono">F12</span> é–‹å•Ÿé–‹ç™¼è€…å·¥å…· â†’ Console æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯ã€‚</li>
      <li>æˆ–æ”¹ç”¨æ­¤é€£ç·šç‰ˆï¼šå°‡æª”æ¡ˆä¸Šå‚³åˆ° GitHub Pages / Netlify Dropã€‚</li>
    </ol>
  </div>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel" data-presets="env,react">
    const { useState } = React;

    // ================== å¸¸ç”¨æ¸…å–® & å°ç…§ ==================
    const unitList = [
      "tab","cap","amp","vial","syrg","btl","patch","pen","pack","supp","tube","dose","U","IU","mcg","mg","g","mL","gtt","q.s."
    ];
    const unitLabel = {
      tab:"éŒ ", cap:"è† å›Š", amp:"å®‰ç“¿", vial:"å°ç“¶", syrg:"é‡ç­’", btl:"ç“¶", patch:"è²¼ç‰‡", pen:"æ³¨å°„ç­†", pack:"åŒ…", supp:"æ “åŠ‘", tube:"æ¢", dose:"åŠ‘é‡", U:"å–®ä½", IU:"åœ‹éš›å–®ä½", mcg:"å¾®å…‹", mg:"æ¯«å…‹", g:"å…¬å…‹", mL:"æ¯«å‡", gtt:"æ»´", "q.s.":"é©é‡"
    };
    const routeList = ["PO","IVD","IVP","SC","IM","INHL","TOPI","RECT"];
    const routeLabel = { PO:"å£æœ", IVD:"éœè„ˆæ»´æ³¨", IVP:"éœè„ˆæ³¨å°„", SC:"çš®ä¸‹æ³¨å°„", IM:"è‚Œè‚‰æ³¨å°„", INHL:"å¸å…¥", TOPI:"å¤–ç”¨", RECT:"è‚›é–€çµ¦è—¥" };
    const attributeList = [
      "è…åŠŸèƒ½ç®¡åˆ¶é‡","è‚åŠŸèƒ½ç®¡åˆ¶é‡","æŠ—å¾®ç”Ÿç‰©è—¥å“","è¡€æ¶²è£½åŠ‘è—¥å“","ä¸å»ºè­°ç®¡çŒ","éœ€æ´—è…å¾Œçµ¦è—¥","éœ€é™„ç­†é‡é‡é ­","éœ€é™„é‡å…·","é™CVCçµ¦è—¥","å†·è—è—¥å“","å†·å‡è—¥",
      "è¡€å‹ç—…è¡€æ¶²è£½åŠ‘","é«˜é¢¨éšªæ›è§¸è—¥å“","æ¨™é¶è—¥å“(æ³¨å°„åŠ‘å‹)","æ¨™é¶è—¥å“(éæ³¨å°„åŠ‘å‹)","é«˜è­¦è¨Šè—¥å“","ç½•è¦‹ç–¾ç—…è—¥å“","ç–«è‹—","Chemoè—¥å“(5FåŒ–ç™‚å®¤èª¿åŠ‘)","æ³¡è£½æº¶æ¶²æ™‚éœ€ä½¿ç”¨Filter","æ»´æ³¨æ™‚éœ€ä½¿ç”¨Filter"
    ];
    const reasonList = [
      "æŒçºŒé‡‹æ”¾åŠ‘å‹","èˆŒä¸‹åŠ‘å‹","è…¸æº¶åŠ‘å‹","å…§ç‚ºæ¶²ç‹€ç‰©","åŒ–å­¸æ²»ç™‚è—¥ï¼Œä¸å»ºè­°ç ”ç£¨","ç™¼æ³¡éŒ åŠ‘å‹","å£æº¶åŠ‘å‹","åˆºæ¿€é»è†œ","å°çœ¼ç›å…·åˆºæ¿€æ€§","å…·è¯åˆä½œç”¨æœƒå½±éŸ¿çºç‘¯è³ª","æ˜“æŸ“è‰²","å¯èƒ½æœƒé€ æˆæ¥è§¸æ€§çš®è†šç‚","å¢åŠ å¸æ”¶","æ˜“æ½®è§£","æ¸›ä½å¸æ”¶","ä»¿å–®å»ºè­°æ•´ç²’åæœ","è—¥å“ç‚ºç²‰åŠ‘","ç®¡åˆ¶è—¥å“"
    ];

    // é »æ¬¡ä¸­æ–‡é¡¯ç¤ºï¼ˆAC/PC åƒ…å½±éŸ¿æ–‡æ¡ˆï¼Œä¸å½±éŸ¿æ¬¡æ•¸ï¼‰
    const freqLabel = {
      QD:"æ¯æ—¥ä¸€æ¬¡", QDAC:"æ¯æ—¥ä¸€æ¬¡ï¼ˆé£¯å‰ï¼‰", QDPC:"æ¯æ—¥ä¸€æ¬¡ï¼ˆé£¯å¾Œï¼‰",
      BID:"æ¯æ—¥å…©æ¬¡", BIDAC:"æ¯æ—¥å…©æ¬¡ï¼ˆé£¯å‰ï¼‰", BIDPC:"æ¯æ—¥å…©æ¬¡ï¼ˆé£¯å¾Œï¼‰",
      TID:"æ¯æ—¥ä¸‰æ¬¡", TIDAC:"æ¯æ—¥ä¸‰æ¬¡ï¼ˆé£¯å‰ï¼‰", TIDPC:"æ¯æ—¥ä¸‰æ¬¡ï¼ˆé£¯å¾Œï¼‰",
      QID:"æ¯æ—¥å››æ¬¡", QIDAC:"æ¯æ—¥å››æ¬¡ï¼ˆé£¯å‰ï¼‰", QIDPC:"æ¯æ—¥å››æ¬¡ï¼ˆé£¯å¾Œï¼‰",
      Q12H:"æ¯12å°æ™‚ä¸€æ¬¡", Q8H:"æ¯8å°æ™‚ä¸€æ¬¡", Q6H:"æ¯6å°æ™‚ä¸€æ¬¡",
      QW:"æ¯é€±ä¸€æ¬¡", Q2W:"æ¯2é€±ä¸€æ¬¡", Q3W:"æ¯3é€±ä¸€æ¬¡", Q4W:"æ¯4é€±ä¸€æ¬¡",
      QM:"æ¯æœˆä¸€æ¬¡", Q2M:"æ¯2æœˆä¸€æ¬¡", Q3M:"æ¯3æœˆä¸€æ¬¡", Q6M:"æ¯6æœˆä¸€æ¬¡",
      PRN:"å¿…è¦æ™‚", STAT:"ç«‹å³çµ¦è—¥", "AS ORDER":"éµé†«å›‘"
    };

    // æ¯æ—¥å¹³å‡æ¬¡æ•¸ï¼ˆå«é€±æœŸé »æ¬¡ï¼‰
    const freqCalc = {
      QD:1, QDAC:1, QDPC:1,
      BID:2, BIDAC:2, BIDPC:2,
      TID:3, TIDAC:3, TIDPC:3,
      QID:4, QIDAC:4, QIDPC:4,
      Q12H:2, Q8H:3, Q6H:4,
      QW:1/7, Q2W:1/14, Q3W:1/21, Q4W:1/28,
      QM:1/30, Q2M:1/60, Q3M:1/90, Q6M:1/180,
      PRN:1, STAT:1, "AS ORDER":1
    };

    const freqList = ["QD","QDAC","QDPC","BID","BIDAC","BIDPC","TID","TIDAC","TIDPC","QID","QIDAC","QIDPC","Q12H","Q8H","Q6H","AS ORDER","PRN","STAT","QW","Q2W","Q3W","Q4W","QM","Q2M","Q3M","Q6M"];

    // ========= æ›ç®—å·¥å…· =========
    function buildConversionMap(drug){
      const map = {};
      for(let i=0;i<4;i++){
        const v = parseFloat(drug[`convertValue${i}`]);
        const u = drug[`convertUnit${i}`];
        if(!isNaN(v) && u){ map[u] = v; }
      }
      return map; 
    }
    
    // è¨ˆç®—ç¸½é‡ï¼ˆç„¡æ¢ä»¶é€²ä½ï¼‰
    function calculateOrderQuantity(baseDose, freq, days, baseUnit, totalUnit, conversionMap){
      const timesPerDay = freqCalc[freq] || 1;
      // æ ¸å¿ƒè¨ˆç®—å…¬å¼ï¼šåŠ‘é‡ * é »æ¬¡/å¤© * å¤©æ•¸
      const baseQty = (Number(baseDose) || 0) * timesPerDay * (Number(days) || 0); 
      const canConvert = Boolean(conversionMap[baseUnit] && conversionMap[totalUnit]);
      const convQtyRaw = canConvert ? baseQty * (conversionMap[totalUnit] / conversionMap[baseUnit]) : baseQty;
      const orderQty = Math.ceil(convQtyRaw);
      const orderUnit = canConvert ? totalUnit : baseUnit;
      return { orderQty, orderUnit };
    }

    // ========= å°å…ƒä»¶ =========
    const SectionTitle = ({children}) => (
      <div className="text-base font-semibold text-slate-700 mb-2 flex items-center gap-2 mt-4 border-b border-slate-200 pb-1">
        <div className="h-3 w-1.5 rounded bg-emerald-600"></div>{children}
      </div>
    );
    const Field = ({label, children}) => (
      <label className="block"><div className="text-sm font-medium text-slate-700 mb-1">{label}</div>{children}</label>
    );
    const TextInput = (p) => <input {...p} className={"focus-style w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/60 " + (p.className||'')} />;
    // ä¿®æ­£ï¼štype="number" ç¢ºä¿è¼¸å…¥çš„æ˜¯æ•¸å­—ï¼Œmin="0"
    const NumberInput = (p) => <input {...p} type="number" min="0" className={"focus-style w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/60 " + (p.className||'')} />;
    const Select = ({value,onChange,children}) => (
      <select value={value} onChange={onChange} className="focus-style w-full rounded-lg border border-slate-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500/60 focus:border-emerald-500">{children}</select>
    );

    // ========= è—¥è¢‹é è¦½ =========
    function BagPreview({ drug, orderQty, orderUnit, days }){
      const routeZh = routeLabel[drug.route] || drug.route || 'â€”';
      const freqZh  = freqLabel[drug.freq] || drug.freq || 'â€”';
      const baseUnitZh  = unitLabel[drug.baseUnit] || drug.baseUnit;
      const displayUnitZh = unitLabel[orderUnit] || orderUnit || baseUnitZh;
      const doseTxt = drug.baseDose ? `æ¯æ¬¡ ${drug.baseDose} ${baseUnitZh||''}` : '';
      const usage   = [routeZh, freqZh, doseTxt].filter(Boolean).join(' ');
      return (
        <section className="bg-white p-5 rounded-2xl shadow-xl ring-2 ring-emerald-200">
          <div className="border-b-2 border-emerald-600 pb-1 mb-2"><div className="text-lg font-bold text-emerald-700">è—¥è¢‹é è¦½</div></div>
          <div className="font-bold text-base mb-1">å­¸åï¼š{drug.generic||'â€”'} {drug.specDesc||''}</div>
          <div className="font-bold text-base mb-1">å•†å“åï¼š{drug.brandEn||'â€”'}ï¼ˆ{drug.brandZh||'â€”'}ï¼‰</div>
          <div className="font-bold text-base mb-1">ç”¨æ³•ç”¨é‡ï¼š{usage||'â€”'}</div>
          <div className="font-bold text-base mb-1">è—¥å“ç¸½é‡ï¼šå…± {orderQty} {displayUnitZh} (å…± {days} å¤©)</div>
          <div className="font-bold text-base mb-1">æ²»ç™‚ç”¨é€”ï¼š{drug.bagTherUse||'â€”'}</div>
          <div className="font-bold text-base mb-1">å‰¯ä½œç”¨ï¼š{drug.bagADR||'â€”'}</div>
          <div className="font-bold text-base mb-1">å» ç‰Œç”¢åœ°ï¼š{drug.mfg||'â€”'}ï¼ˆ{drug.origin||'â€”'}ï¼‰</div>
          <div className="font-bold text-base mb-1">å„²å­˜æ–¹å¼ï¼š{drug.bagStorage||'â€”'}</div>
        </section>
      );
    }

    // ========= ä¸»é  =========
    function App(){
      const [drug, setDrug] = useState({
        // è—¥å
        generic:"", specDesc:"", atc:"",
        brandZh:"", brandEn:"", mfg:"", origin:"",
        // å–®ä½è¨­å®š
        baseDose:"", baseUnit:"", orderUnit:"", priceUnit:"", totalUnit:"", bagSubUnit:"",
        // åŠ‘é‡è½‰æ›ï¼ˆ4 çµ„ï¼‰
        convertValue0:"", convertUnit0:"", convertValue1:"", convertUnit1:"", convertValue2:"", convertUnit2:"", convertValue3:"", convertUnit3:"",
        // ç‰¹æ®Šé™åˆ¶
        crush_forbid:false, unitdose_forbid:false, split_forbid:false, specialReason:"",
        // ç”¨æ³•èˆ‡é »æ¬¡
        route:"", freq:"",
        // å±¬æ€§
        attributes:[],
        // è—¥è¢‹è³‡æ–™
        bagTherUse:"", bagADR:"", bagStorage:""
      });

      // å°‡å¤©æ•¸æ”¹ç‚º stateï¼Œåˆå§‹å€¼ç‚º 7 å¤©
      const [days, setDays] = useState(7); 
      
      const convMap = buildConversionMap(drug);
      const { orderQty, orderUnit } = calculateOrderQuantity(
        drug.baseDose, drug.freq, days, drug.baseUnit, drug.totalUnit, convMap
      );
      
      return (
        <div className="min-h-screen text-slate-800 bg-slate-50">
          <header className="bg-emerald-600 px-4 py-4 flex justify-between items-center shadow-lg">
            <div className="font-bold text-xl text-white">ğŸ’Š æ–°è—¥å»ºæª”æ¨¡æ“¬ç³»çµ±</div>
          </header>

          {/* ç‰ˆé¢ï¼šå·¦ = è—¥å“åŸºæœ¬æª”ï¼›å³ = ä¸Šï¼šé†«å›‘ï¼Œä¸‹ï¼šè—¥è¢‹ (ä½¿ç”¨ lg:grid-cols-2 ç¢ºä¿å·¦å³å…©æ¬„æ’ç‰ˆ) */}
          <main className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6 p-6">
            {/* å·¦ï¼šè—¥å“åŸºæœ¬æª” */}
            <section className="bg-white p-5 rounded-2xl shadow-lg ring-1 ring-slate-200 overflow-y-auto">
              <div className="text-xl font-bold mb-4 text-emerald-700">è—¥å“åŸºæœ¬æª”</div>

              <SectionTitle>è—¥å</SectionTitle>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <Field label="å­¸å"><TextInput value={drug.generic} onChange={e=>setDrug({...drug,generic:e.target.value})}/></Field>
                <Field label="ä¸­æ–‡å•†å“å"><TextInput value={drug.brandZh} onChange={e=>setDrug({...drug,brandZh:e.target.value})}/></Field>
                <Field label="è‹±æ–‡å•†å“å"><TextInput value={drug.brandEn} onChange={e=>setDrug({...drug,brandEn:e.target.value})}/></Field>
                <Field label="ATC ä»£ç¢¼"><TextInput value={drug.atc} onChange={e=>setDrug({...drug,atc:e.target.value})}/></Field>
                <Field label="è£½é€ å» åç¨±"><TextInput value={drug.mfg} onChange={e=>setDrug({...drug,mfg:e.target.value})}/></Field>
                <Field label="ç”¢åœ°"><TextInput value={drug.origin} onChange={e=>setDrug({...drug,origin:e.target.value})}/></Field>
              </div>

              <SectionTitle>è¦æ ¼å«é‡</SectionTitle>
              <Field label="è¦æ ¼å«é‡æè¿°"><TextInput value={drug.specDesc} onChange={e=>setDrug({...drug,specDesc:e.target.value})}/></Field>

              <SectionTitle>å–®ä½è¨­å®š</SectionTitle>
              {/* åŸºæœ¬åŠ‘é‡èˆ‡åŸºæœ¬å–®ä½ï¼šåŒä¸€è¡Œ */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <Field label="åŸºæœ¬åŠ‘é‡">
                  <NumberInput type="text" value={drug.baseDose} onChange={e=>setDrug({...drug,baseDose:e.target.value})}/>
                </Field>
                <Field label="åŸºæœ¬å–®ä½">
                  <Select value={drug.baseUnit} onChange={e=>setDrug({...drug,baseUnit:e.target.value})}>
                    <option value="">é¸æ“‡</option>
                    {unitList.map(u => <option key={u}>{u}</option>)}
                  </Select>
                </Field>
              </div>
              {/* å…¶ä»–å–®ä½ï¼šåŒä¸€è¡Œå››æ¬„ */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <Field label="é†«å›‘å–®ä½">
                  <Select value={drug.orderUnit} onChange={e=>setDrug({...drug,orderUnit:e.target.value})}>
                    <option value="">é¸æ“‡</option>
                    {unitList.map(u => <option key={u}>{u}</option>)}
                  </Select>
                </Field>
                <Field label="è¨ˆåƒ¹å–®ä½">
                  <Select value={drug.priceUnit} onChange={e=>setDrug({...drug,priceUnit:e.target.value})}>
                    <option value="">é¸æ“‡</option>
                    {unitList.map(u => <option key={u}>{u}</option>)}
                  </Select>
                </Field>
                <Field label="çµ¦è—¥ç¸½é‡å–®ä½">
                  <Select value={drug.totalUnit} onChange={e=>setDrug({...drug,totalUnit:e.target.value})}>
                    <option value="">é¸æ“‡</option>
                    {unitList.map(u => <option key={u}>{u}</option>)}
                  </Select>
                </Field>
                <Field label="è—¥è¢‹æ¬¡é‡å–®ä½">
                  <Select value={drug.bagSubUnit} onChange={e=>setDrug({...drug,bagSubUnit:e.target.value})}>
                    <option value="">é¸æ“‡</option>
                    {unitList.map(u => <option key={u}>{u}</option>)}
                  </Select>
                </Field>
              </div>

              <SectionTitle>åŠ‘é‡è½‰æ›ä¿‚æ•¸</SectionTitle>
              <div className="grid grid-cols-4 gap-2 mb-4">
                {[0,1,2,3].map(i => (
                  <div key={i} className="flex gap-2 items-center">
                    <NumberInput type="text" value={drug[`convertValue${i}`] || ''} onChange={e=>setDrug({...drug,[`convertValue${i}`]:e.target.value})}/>
                    <Select value={drug[`convertUnit${i}`] || ''} onChange={e=>setDrug({...drug,[`convertUnit${i}`]:e.target.value})}>
                      <option value="">é¸æ“‡å–®ä½</option>
                      {unitList.map(u => (<option key={u}>{u}</option>))}
                    </Select>
                  </div>
                ))}
                <div className="text-xs text-slate-500 col-span-4">ä¾‹ï¼š1 btl = 10 mL = 200 gttï¼ˆè«‹ä¾å·¦åˆ°å³å¡«å…¥ 2â€“4 çµ„ï¼‰</div>
              </div>

              <SectionTitle>å£æœè—¥å“ç‰¹æ®ŠåŠ‘å‹é™åˆ¶</SectionTitle>
              <div className="flex flex-col md:flex-row gap-4 text-sm items-start">
                <div className="flex flex-col gap-2 w-40">
                  <label className="flex items-center gap-2"><input type="checkbox" checked={drug.crush_forbid} onChange={e=>setDrug({...drug,crush_forbid:e.target.checked})}/>ä¸å¯ç£¨ç²‰</label>
                  <label className="flex items-center gap-2"><input type="checkbox" checked={drug.unitdose_forbid} onChange={e=>setDrug({...drug,unitdose_forbid:e.target.checked})}/>ä¸å¯åˆ†åŒ…</label>
                  <label className="flex items-center gap-2"><input type="checkbox" checked={drug.split_forbid} onChange={e=>setDrug({...drug,split_forbid:e.target.checked})}/>ä¸å¯å‰</label>
                </div>
                <div className="flex-1">
                  <Field label="åŸå› ">
                    <Select value={drug.specialReason||''} onChange={e=>setDrug({...drug,specialReason:e.target.value})}>
                      <option value="">é¸æ“‡åŸå› </option>
                      {reasonList.map(r => (<option key={r}>{r}</option>))}
                    </Select>
                  </Field>
                </div>
              </div>

              <SectionTitle>ç”¨æ³•ã€é »æ¬¡èˆ‡å¤©æ•¸</SectionTitle>
              {/* å¤©æ•¸è¼¸å…¥æ¡†ä¿®æ­£ç‚ºèˆ‡é€”å¾‘/é »æ¬¡æ’ç‰ˆåœ¨åŒä¸€åˆ— */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <Field label="çµ¦è—¥é€”å¾‘"><Select value={drug.route} onChange={e=>setDrug({...drug,route:e.target.value})}><option value="">é¸æ“‡</option>{routeList.map(r => (<option key={r}>{r}</option>))}</Select></Field>
                <Field label="çµ¦è—¥é »æ¬¡"><Select value={drug.freq} onChange={e=>setDrug({...drug,freq:e.target.value})}><option value="">é¸æ“‡</option>{Object.keys(freqCalc).map(f => (<option key={f}>{f}</option>))}</Select></Field>
                <Field label="å¤©æ•¸">
                    <NumberInput 
                        value={days} 
                        onChange={e => setDays(Number(e.target.value))} 
                        placeholder="è«‹è¼¸å…¥å¤©æ•¸"
                    />
                </Field>
              </div>

              <SectionTitle>å±¬æ€§</SectionTitle>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                {attributeList.map(attr => (
                  <label key={attr} className="flex items-center gap-2">
                    <input type="checkbox" checked={drug.attributes?.includes(attr)} onChange={()=>{
                      const set = new Set(drug.attributes||[]);
                      set.has(attr) ? set.delete(attr) : set.add(attr);
                      setDrug({...drug, attributes:[...set]});
                    }}/> {attr}
                  </label>
                ))}
              </div>

              <SectionTitle>è—¥è¢‹è³‡æ–™</SectionTitle>
              <div className="grid gap-4">
                <Field label="æ²»ç™‚ç”¨é€”"><TextInput value={drug.bagTherUse} onChange={e=>setDrug({...drug,bagTherUse:e.target.value})}/></Field>
                <Field label="å‰¯ä½œç”¨å…§å®¹"><TextInput value={drug.bagADR} onChange={e=>setDrug({...drug,bagADR:e.target.value})}/></Field>
                <Field label="å„²å­˜æ–¹å¼"><TextInput value={drug.bagStorage} onChange={e=>setDrug({...drug,bagStorage:e.target.value})}/></Field>
              </div>
            </section>

            {/* å³æ¬„ï¼šä¸Šâ†’é†«å›‘é–‹ç«‹ç•«é¢ï¼›ä¸‹â†’è—¥è¢‹é è¦½ */}
            <div className="flex flex-col gap-6">
              {/* é†«å›‘é–‹ç«‹ç•«é¢ */}
              <section className="bg-white p-5 rounded-2xl shadow-lg ring-1 ring-emerald-300">
                <div className="text-lg font-bold mb-2 text-slate-700">é†«å›‘é–‹ç«‹ç•«é¢</div>
                <div className="border border-slate-200 rounded-xl overflow-hidden">
                  <table className="w-full text-sm">
                    <thead className="order-table sticky top-0 z-10">
                      <tr>
                        <th className="p-2 text-left">è—¥å</th>
                        <th className="p-2 text-left">åŠ‘é‡</th>
                        <th className="p-2 text-left">é€”å¾‘</th>
                        <th className="p-2 text-left">é »æ¬¡</th>
                        <th className="p-2 text-left">å¤©æ•¸</th>
                        <th className="p-2 text-left">ç¸½é‡</th>
                        <th className="p-2 text-left">æé†’</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100">
                      <tr className="odd:bg-white even:bg-slate-50 hover:bg-emerald-50/40 transition-colors">
                        <td className="p-2">{[drug.generic, drug.specDesc].filter(Boolean).join(' ') || 'â€”'}</td>
                        <td className="p-2">{drug.baseDose || 'â€”'} {unitLabel[drug.baseUnit] || drug.baseUnit || ''}</td>
                        <td className="p-2">{drug.route || 'â€”'}</td>
                        <td className="p-2">{drug.freq || 'â€”'}</td>
                        <td className="p-2 font-bold text-lg">{days} å¤©</td> 
                        <td className="p-2 font-bold text-lg text-emerald-700">{orderQty} {unitLabel[orderUnit] || orderUnit || ''}</td> 
                        <td className="p-2 text-xs text-red-600 font-medium">
                          {(drug.crush_forbid || drug.unitdose_forbid || drug.split_forbid || drug.specialReason)
                            ? [
                                drug.crush_forbid ? 'ä¸å¯ç£¨ç²‰' : '',
                                drug.unitdose_forbid ? 'ä¸å¯åˆ†åŒ…' : '',
                                drug.split_forbid ? 'ä¸å¯å‰' : '',
                                drug.specialReason ? `${drug.specialReason}` : ''
                              ].filter(Boolean).join(' ')
                            : ''}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </section>

              {/* è—¥è¢‹é è¦½ */}
              <BagPreview drug={drug} orderQty={orderQty} orderUnit={orderUnit} days={days} />
            </div>
          </main>
        </div>
      );
    }

    // æ›è¼‰ React æ‡‰ç”¨
    try {
      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    } catch (e) {
      document.getElementById('fallback').style.display = 'block';
      console.error(e);
    }
  </script>
</body>
</html>